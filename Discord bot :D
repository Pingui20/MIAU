import discord
from discord.ext import commands
import random
import time

# Configuración de intents
intents = discord.Intents.default()
intents.message_content = True

# Crear bot con el prefijo de comando y cliente para manejar eventos
bot = commands.Bot(command_prefix='/', intents=intents)

# Variable para controlar si el bot está activo o inactivo
bot_activo = False
# Variable que detecta si las curiosidades ya fueron pedidas
curiosidades = False

# Datos curiosos de gatos
datos = [
    "Los gatos pueden dormir hasta 16 horas al día.",
    "Los bigotes de los gatos son órganos sensoriales extremadamente sensibles.",
    "Los gatos tienen una visión nocturna excepcional.",
    "Los gatos pueden escuchar sonidos de alta frecuencia.",
    "Los gatos tienen una flexibilidad asombrosa.",
    "La lengua de los gatos es áspera para acicalarse y beber.",
    "Las uñas de los gatos son retráctiles.",
    "Los gatos tienen más huesos que los humanos.",
    "Los gatos tienen expresiones faciales variadas.",
    "Los gatos tienen un sentido del olfato muy desarrollado.",
    "Cada huella de pata de un gato es única.",
    "Los gatos ronronean en diferentes situaciones.",
    "Los gatos no son exclusivamente nocturnos.",
    "Los gatos tienen glándulas odoríferas para marcar territorio.",
    "Los gatos pueden detectar el miedo en las personas.",
    "Los gatos pueden aprender trucos.",
    "Los gatos tienen un órgano vomeronasal para detectar feromonas.",
    "Los gatos pueden vivir hasta 20 años.",
    "Los gatos fueron domesticados hace miles de años.",
    "Existen más de 40 razas de gatos."
]

# Evento de inicio del bot
@bot.event
async def on_ready():
    print(f'Conexión exitosa, iniciamos sesión como: {bot.user}')

# Comando para repetir "heh" varias veces
@bot.command()
async def heh(ctx, count_heh=5):
    if bot_activo:
        await ctx.send("he" * count_heh)

# Comando para mostrar cuándo un miembro se unió al servidor
@bot.command()
async def joined(ctx, member: discord.Member):
    if bot_activo:
        await ctx.send(f'{member.name} se unió el {discord.utils.format_dt(member.joined_at)}')

# Manejo de mensajes personalizados para activar/desactivar el bot y dar curiosidades
@bot.event
async def on_message(message):
    global bot_activo  # Asegura que modificamos la variable global
    global curiosidades

    if message.author == bot.user:
        return
    
    # Si el bot está inactivo y no es un saludo, no responde
    if not bot_activo and message.content != 'Hola Michibot':
        return

    # Si el mensaje es "Hola Michibot", activa el bot
    if message.content == 'Hola Michibot':
        bot_activo = True
        await message.channel.send("¡Holi! ¿En qué puedo ayudarte? >ω<")
    
    # Si el mensaje es "Adios Michibot", desactiva el bot
    elif message.content == 'Adios Michibot':
        bot_activo = False
        await message.channel.send("¡Adios! :3")
        curiosidades = False

    # Si el bot está activo, procesa los comandos y respuestas
    elif bot_activo:
        # Si el mensaje es "Hora de aprender!!"
        if message.content.startswith('Hora de aprender!!'):
            Aleatorio = random.choice(datos)
            await message.channel.send("Meow, ¡acá te va uno!")
            curiosidades = True
            time.sleep(1)
            await message.channel.send(Aleatorio)

        # Si el mensaje es "Otro" y el bot ya había dado una curiosidad
        elif message.content.startswith('Otro') and curiosidades:
            Aleatorio2 = random.choice(datos)
            await message.channel.send("Meow, ¡acá te va otro!")
            time.sleep(1)
            await message.channel.send(Aleatorio2)
        
        else:
            # Procesar comandos
            await bot.process_commands(message)
    
    # Si el bot está inactivo, no procesa ningún comando ni mensaje
    else:
        return

# Iniciar el bot
bot.run("TOKEN")
